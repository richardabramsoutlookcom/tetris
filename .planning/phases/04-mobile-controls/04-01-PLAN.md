---
phase: 04-mobile-controls
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tetris-app/src/components/TouchControls.jsx
  - tetris-app/src/components/TouchControls.css
  - tetris-app/src/components/Game.jsx
  - tetris-app/src/components/Game.css
autonomous: false

must_haves:
  truths:
    - "User can move piece left by tapping left button"
    - "User can move piece right by tapping right button"
    - "User can soft drop by tapping down button"
    - "User can hard drop by tapping drop button"
    - "User can rotate piece by tapping rotate button"
    - "User can hold piece by tapping hold button"
    - "Touch controls only appear on touch-capable devices"
    - "Touch controls do not interfere with keyboard input"
  artifacts:
    - path: "tetris-app/src/components/TouchControls.jsx"
      provides: "Touch control buttons component"
      min_lines: 50
    - path: "tetris-app/src/components/TouchControls.css"
      provides: "Touch control styling and layout"
      min_lines: 80
  key_links:
    - from: "TouchControls.jsx"
      to: "Game.jsx action handlers"
      via: "onLeft/onRight/onDown/onRotate/onHold/onDrop props"
      pattern: "on(Left|Right|Down|Rotate|Hold|Drop)"
    - from: "Touch event handlers"
      to: "Game actions"
      via: "preventDefault stops scroll during play"
      pattern: "e\\.preventDefault"
---

<objective>
Add touch controls for mobile gameplay with D-pad and action buttons.

Purpose: Enable mobile users to play Tetris without a keyboard using on-screen virtual controls.
Output: TouchControls component with D-pad (left/right/down) and action buttons (rotate, hold, hard drop) that appears only on touch devices.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Source files:
@tetris-app/src/components/Game.jsx
@tetris-app/src/components/Game.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TouchControls component</name>
  <files>tetris-app/src/components/TouchControls.jsx, tetris-app/src/components/TouchControls.css</files>
  <action>
Create TouchControls component with:

**Layout structure:**
- Left side: D-pad with UP (rotate), LEFT, RIGHT, DOWN buttons arranged in cross pattern
- Right side: Action buttons - HOLD (top), DROP (bottom, larger)

**Touch handling:**
- Use onTouchStart for button activation (immediate response)
- Use onTouchEnd to clear state
- Call e.preventDefault() in touch handlers to prevent scroll/zoom
- Pass action callbacks via props: onLeft, onRight, onDown, onRotate, onHold, onDrop

**Button implementation:**
- D-pad buttons: visual arrows (◀ ▶ ▲ ▼) or CSS triangles
- Hold button: "HOLD" text
- Drop button: "DROP" text, visually larger/prominent
- Active state styling when button is pressed

**Component structure:**
```jsx
export function TouchControls({ onLeft, onRight, onDown, onRotate, onHold, onDrop }) {
  // Touch handlers call props, prevent default
  return (
    <div className="touch-controls">
      <div className="touch-dpad">
        <button className="dpad-up" onTouchStart={...}>▲</button>
        <button className="dpad-left" onTouchStart={...}>◀</button>
        <button className="dpad-right" onTouchStart={...}>▶</button>
        <button className="dpad-down" onTouchStart={...}>▼</button>
      </div>
      <div className="touch-actions">
        <button className="action-hold" onTouchStart={...}>HOLD</button>
        <button className="action-drop" onTouchStart={...}>DROP</button>
      </div>
    </div>
  );
}
```

**CSS requirements:**
- Position fixed at bottom of viewport
- Semi-transparent background to not fully obscure game
- Large touch targets (min 44px per Apple HIG, prefer 60-80px for game controls)
- Use CSS custom properties for theming compatibility
- Responsive: hide on desktop (media query or touch detection)
- D-pad: grid layout for cross pattern
- Buttons: rounded, clear visual feedback on :active

**Do NOT:**
- Use external libraries - native touch events only
- Add auto-repeat for movement (keep it simple for v1)
  </action>
  <verify>npm run build succeeds, no TypeScript/ESLint errors</verify>
  <done>TouchControls component renders with D-pad and action buttons, styled for mobile</done>
</task>

<task type="auto">
  <name>Task 2: Integrate TouchControls into Game.jsx</name>
  <files>tetris-app/src/components/Game.jsx, tetris-app/src/components/Game.css</files>
  <action>
Add TouchControls to Game component:

**Touch detection:**
- Check for touch capability: `'ontouchstart' in window || navigator.maxTouchPoints > 0`
- Store in state or compute inline
- Only render TouchControls when touch is available

**Wire up handlers:**
```jsx
import { TouchControls } from './TouchControls';

// In Game component:
const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

// Render at end of game-container (after all other content):
{isTouchDevice && isPlaying && !gameOver && !isPaused && (
  <TouchControls
    onLeft={() => movePiece(-1, 0)}
    onRight={() => movePiece(1, 0)}
    onDown={() => softDrop()}
    onRotate={() => rotatePiece(1)}
    onHold={() => holdPiece()}
    onDrop={() => hardDrop()}
  />
)}
```

**Key behaviors:**
- Only show during active gameplay (isPlaying && !gameOver && !isPaused)
- Hide when modals open (settings, high score, leaderboard)
- Controls should not block game board visibility

**CSS adjustments in Game.css:**
- Add bottom padding to game-container on mobile when touch controls present
- Ensure touch controls don't overlap game board

**Do NOT:**
- Modify keyboard handling (touch is additive)
- Add complex state management for touch
  </action>
  <verify>npm run build succeeds, touch controls render on mobile viewport simulation</verify>
  <done>TouchControls integrated and conditionally rendered on touch devices during gameplay</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Mobile touch controls with D-pad and action buttons</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open browser DevTools → Toggle device toolbar (Ctrl+Shift+M or Cmd+Shift+M)
    3. Select mobile device (e.g., iPhone 12 Pro or Pixel 5)
    4. Refresh the page
    5. Click "Start Game"
    6. Verify: Touch controls appear at bottom of screen
    7. Test each control (tap the buttons):
       - LEFT arrow: piece moves left
       - RIGHT arrow: piece moves right
       - DOWN arrow: piece soft drops
       - UP arrow: piece rotates
       - HOLD: piece is held (if available)
       - DROP: piece hard drops
    8. Verify: Controls have visual feedback when tapped
    9. Verify: Game board is not obscured by controls
    10. Switch to desktop viewport: controls should NOT appear
  </how-to-verify>
  <resume-signal>Type "approved" if all controls work correctly, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] TouchControls component exists and is properly styled
- [ ] Touch controls appear only on touch devices
- [ ] All 6 actions work via touch (left, right, down, rotate, hold, drop)
- [ ] Controls hidden during pause, game over, and before start
- [ ] Visual verification passed
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Touch controls work on mobile simulation
- User approved visual layout and functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/04-mobile-controls/04-01-SUMMARY.md`
</output>

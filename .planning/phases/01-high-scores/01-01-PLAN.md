---
phase: 01-high-scores
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tetris-app/src/hooks/useHighScores.js
  - tetris-app/src/components/HighScoreEntry.jsx
  - tetris-app/src/components/HighScoreEntry.css
  - tetris-app/src/components/Leaderboard.jsx
  - tetris-app/src/components/Leaderboard.css
  - tetris-app/src/components/Game.jsx
  - tetris-app/src/components/Game.css
autonomous: true

must_haves:
  truths:
    - "User can see top 10 scores on a leaderboard screen"
    - "User can enter initials when game ends with a qualifying score"
    - "High scores persist after closing and reopening the browser"
  artifacts:
    - path: "tetris-app/src/hooks/useHighScores.js"
      provides: "High score state management and localStorage persistence"
      exports: ["useHighScores"]
    - path: "tetris-app/src/components/HighScoreEntry.jsx"
      provides: "Modal for entering initials after qualifying score"
      exports: ["HighScoreEntry"]
    - path: "tetris-app/src/components/Leaderboard.jsx"
      provides: "Display of top 10 high scores"
      exports: ["Leaderboard"]
  key_links:
    - from: "Game.jsx"
      to: "useHighScores"
      via: "hook call and score submission"
      pattern: "useHighScores\\(\\)"
    - from: "Game.jsx game over flow"
      to: "HighScoreEntry"
      via: "conditional render when score qualifies"
      pattern: "isQualifyingScore.*HighScoreEntry"
    - from: "useHighScores"
      to: "localStorage"
      via: "getItem/setItem with try-catch"
      pattern: "localStorage\\.(get|set)Item"
---

<objective>
Implement high score system with top 10 leaderboard and localStorage persistence.

Purpose: Give players a reason to replay by tracking and displaying their best scores.
Output: Working high score entry flow after game over, persistent leaderboard display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Codebase patterns to follow:
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/ARCHITECTURE.md

# Existing files to modify/reference:
@tetris-app/src/hooks/useKeyBindings.js — localStorage pattern to follow
@tetris-app/src/components/Game.jsx — game over flow to integrate with
@tetris-app/src/hooks/useGameLogic.js — score/gameOver state source
@tetris-app/src/components/KeyBindings.jsx — modal pattern reference
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useHighScores hook</name>
  <files>tetris-app/src/hooks/useHighScores.js</files>
  <action>
Create hook following the localStorage pattern from useKeyBindings.js:

1. Define constants:
   - `STORAGE_KEY = 'tetris-highscores'`
   - `MAX_SCORES = 10`

2. State initialization with lazy loading from localStorage:
   - Load saved scores on mount (try/catch like useKeyBindings)
   - Default to empty array if no saved scores

3. Export functions:
   - `highScores`: array of { initials: string, score: number, date: string }
   - `isQualifyingScore(score)`: returns true if score would make top 10 (score > 0 AND (fewer than 10 scores OR score beats lowest))
   - `addHighScore(initials, score)`: adds score, sorts descending, trims to 10, saves to localStorage
   - `clearHighScores()`: resets to empty array (for testing/settings)

4. useEffect to persist to localStorage when highScores changes (like useKeyBindings pattern)

Follow conventions:
- Named export: `export function useHighScores()`
- camelCase function names
- try/catch for localStorage operations with console.warn on failure
  </action>
  <verify>File exists, exports useHighScores function, no syntax errors</verify>
  <done>Hook provides highScores state, isQualifyingScore check, addHighScore function, localStorage persistence</done>
</task>

<task type="auto">
  <name>Task 2: Create HighScoreEntry component</name>
  <files>tetris-app/src/components/HighScoreEntry.jsx, tetris-app/src/components/HighScoreEntry.css</files>
  <action>
Create modal component for entering initials after a qualifying score.

HighScoreEntry.jsx:
1. Props: `score`, `onSubmit`, `onCancel`
2. State: `initials` (string, max 3 chars, uppercase)
3. UI:
   - Title: "NEW HIGH SCORE!"
   - Display the score achieved
   - Text input for initials (maxLength=3, autoFocus)
   - Transform input to uppercase
   - Submit button (disabled if initials empty)
   - Cancel/Skip button
4. Handle Enter key to submit
5. Call `onSubmit(initials)` when submitted
6. Call `onCancel()` when skipped

Follow modal pattern from KeyBindings.jsx:
- Overlay background with semi-transparent dark
- Centered content box
- Named export

HighScoreEntry.css:
- Match existing game UI style (dark theme, neon accents)
- Overlay: fixed position, full screen, semi-transparent background
- Modal box: centered, rounded corners, padding
- Input field: large text, centered, uppercase
- Buttons: match existing button styles from Game.css
  </action>
  <verify>Component renders without errors, accepts input, calls callbacks</verify>
  <done>Modal displays score, accepts 3-character initials input, submits or cancels</done>
</task>

<task type="auto">
  <name>Task 3: Create Leaderboard component</name>
  <files>tetris-app/src/components/Leaderboard.jsx, tetris-app/src/components/Leaderboard.css</files>
  <action>
Create component to display top 10 high scores.

Leaderboard.jsx:
1. Props: `scores` (array), `onClose`, `currentScore` (optional - to highlight just-added score)
2. Display:
   - Title: "HIGH SCORES" or "LEADERBOARD"
   - Numbered list 1-10
   - Each row: rank, initials, score (formatted with toLocaleString)
   - Highlight the current player's score if provided
   - Empty slots show "---" or placeholder
   - Close button
3. Named export: `export function Leaderboard`

Leaderboard.css:
- Match game aesthetic (dark, space theme)
- Overlay style like HighScoreEntry
- Table/list with clear ranking numbers
- Score alignment (right-align numbers)
- Highlight style for current score (subtle glow or different color)
- Responsive sizing
  </action>
  <verify>Component renders with empty scores, with partial scores, with full 10 scores</verify>
  <done>Leaderboard displays up to 10 scores with rank, initials, score; highlights current score</done>
</task>

<task type="auto">
  <name>Task 4: Integrate high scores into Game.jsx</name>
  <files>tetris-app/src/components/Game.jsx, tetris-app/src/components/Game.css</files>
  <action>
Wire high score system into game flow.

Game.jsx modifications:
1. Import new hook and components:
   - `import { useHighScores } from '../hooks/useHighScores'`
   - `import { HighScoreEntry } from './HighScoreEntry'`
   - `import { Leaderboard } from './Leaderboard'`

2. Add state for high score flow:
   - `showHighScoreEntry` - true when game over with qualifying score
   - `showLeaderboard` - true when viewing leaderboard
   - `lastSubmittedScore` - track for highlighting in leaderboard

3. Use the hook:
   - `const { highScores, isQualifyingScore, addHighScore } = useHighScores()`

4. Modify game over flow (in the overlay section ~line 148-158):
   - When gameOver becomes true, check `isQualifyingScore(score)`
   - If qualifying: show HighScoreEntry instead of standard game over
   - If not qualifying: show standard game over with "View High Scores" button

5. Add handlers:
   - `handleHighScoreSubmit(initials)`: calls addHighScore, sets lastSubmittedScore, shows leaderboard
   - `handleHighScoreSkip()`: hides entry, shows standard game over
   - `handleShowLeaderboard()`: shows leaderboard
   - `handleCloseLeaderboard()`: hides leaderboard

6. Conditional rendering in overlay:
   - If gameOver && showHighScoreEntry: render HighScoreEntry
   - If showLeaderboard: render Leaderboard
   - Else: existing game over / start / pause overlays

7. Add "High Scores" button to start screen (before game begins)

Game.css additions:
- Any additional styles needed for high score button placement
  </action>
  <verify>
Run `npm run build` in tetris-app/ - should compile without errors.
Manual test: Start game, lose, check if high score flow triggers.
  </verify>
  <done>
Game over flow checks for qualifying score and shows appropriate UI.
Users can enter initials, view leaderboard, scores persist across refresh.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd tetris-app && npm run build` succeeds without errors
- [ ] `cd tetris-app && npm run lint` passes (or only pre-existing warnings)
- [ ] All 4 new files exist with proper exports
- [ ] Game.jsx properly imports and uses new components
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No new ESLint errors introduced
- High score entry appears after game over with qualifying score
- Leaderboard displays saved scores
- Scores persist in localStorage across browser refresh
</success_criteria>

<output>
After completion, create `.planning/phases/01-high-scores/01-01-SUMMARY.md`
</output>

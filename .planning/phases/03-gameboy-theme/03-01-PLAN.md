---
phase: 03-gameboy-theme
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tetris-app/src/hooks/useTheme.js
  - tetris-app/src/index.css
  - tetris-app/src/components/Game.jsx
  - tetris-app/src/components/Game.css
  - tetris-app/src/components/ThemeToggle.jsx
  - tetris-app/src/components/ThemeToggle.css
  - tetris-app/src/components/ScorePanel.css
  - tetris-app/src/components/HoldPiece.css
  - tetris-app/src/components/NextPiece.css
  - tetris-app/src/components/Controls.css
  - tetris-app/src/components/GameBoard.css
  - tetris-app/src/components/MusicSelector.css
autonomous: true

must_haves:
  truths:
    - "User can see green-tinted DMG Gameboy visuals during gameplay"
    - "User can toggle between modern and Gameboy modes"
    - "Theme preference persists across browser sessions"
  artifacts:
    - path: "tetris-app/src/hooks/useTheme.js"
      provides: "Theme state management with localStorage persistence"
      exports: ["useTheme"]
    - path: "tetris-app/src/components/ThemeToggle.jsx"
      provides: "Theme toggle UI component"
      exports: ["ThemeToggle"]
    - path: "tetris-app/src/index.css"
      provides: "CSS custom properties for both themes"
      contains: "--color-"
  key_links:
    - from: "useTheme.js"
      to: "localStorage"
      via: "getItem/setItem"
      pattern: "localStorage\\.(get|set)Item"
    - from: "Game.jsx"
      to: "document.documentElement"
      via: "data-theme attribute"
      pattern: "dataset\\.theme"
    - from: "index.css"
      to: "component CSS files"
      via: "CSS variable references"
      pattern: "var\\(--color-"
---

<objective>
Implement Gameboy DMG visual theme with toggle.

Purpose: Give users the option to play with authentic retro green-tinted Gameboy aesthetics, fulfilling the nostalgia factor of the Gameboy Tetris experience.
Output: Theme system with CSS variables, useTheme hook, and toggle component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@tetris-app/src/index.css
@tetris-app/src/components/Game.jsx
@tetris-app/src/components/Game.css
@tetris-app/src/components/GameBoard.css
@tetris-app/src/components/ScorePanel.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create theme system with CSS variables and useTheme hook</name>
  <files>tetris-app/src/hooks/useTheme.js, tetris-app/src/index.css</files>
  <action>
    1. Create useTheme.js hook:
       - State: theme ('modern' | 'gameboy'), default 'modern'
       - On mount: read from localStorage('tetris-theme'), apply to document.documentElement.dataset.theme
       - Expose: { theme, toggleTheme, setTheme }
       - toggleTheme: switch between 'modern' and 'gameboy', persist to localStorage
       - Use useEffect to sync data-theme attribute when theme changes

    2. Update index.css with CSS custom properties:
       Define :root (modern theme - default):
       - --color-bg: #000010 (dark blue-black)
       - --color-text: #ffffff
       - --color-text-muted: rgba(200, 200, 255, 0.8)
       - --color-accent: #88f (blue glow)
       - --color-accent-secondary: #f80 (orange for hold)
       - --color-panel-bg: linear-gradient(135deg, rgba(100, 100, 150, 0.2), rgba(50, 50, 80, 0.2))
       - --color-panel-border: rgba(150, 150, 200, 0.4)
       - --color-board-bg: rgba(0, 0, 20, 0.9)
       - --color-grid-line: rgba(50, 50, 80, 0.4)
       - --color-overlay-bg: rgba(0, 0, 20, 0.9)
       - --color-button-bg: linear-gradient(135deg, rgba(100, 100, 200, 0.5), rgba(50, 50, 150, 0.5))
       - --color-button-border: rgba(150, 150, 255, 0.6)
       - --color-level: #0f0 (green for level display)

       Define [data-theme="gameboy"] (Gameboy DMG palette):
       - --color-bg: #0f380f (darkest green)
       - --color-text: #9bbc0f (lightest green)
       - --color-text-muted: #8bac0f (light green)
       - --color-accent: #9bbc0f
       - --color-accent-secondary: #9bbc0f
       - --color-panel-bg: #0f380f
       - --color-panel-border: #306230
       - --color-board-bg: #0f380f
       - --color-grid-line: #306230
       - --color-overlay-bg: rgba(15, 56, 15, 0.95)
       - --color-button-bg: #306230
       - --color-button-border: #9bbc0f
       - --color-level: #9bbc0f

       Update body background to use var(--color-bg)
  </action>
  <verify>
    - npm run build succeeds
    - useTheme hook exports theme, toggleTheme, setTheme
    - CSS variables defined in :root and [data-theme="gameboy"]
  </verify>
  <done>Theme hook persists to localStorage, CSS variables defined for both themes</done>
</task>

<task type="auto">
  <name>Task 2: Integrate theme toggle and update component styles</name>
  <files>
    tetris-app/src/components/ThemeToggle.jsx,
    tetris-app/src/components/ThemeToggle.css,
    tetris-app/src/components/Game.jsx,
    tetris-app/src/components/Game.css,
    tetris-app/src/components/GameBoard.css,
    tetris-app/src/components/ScorePanel.css,
    tetris-app/src/components/HoldPiece.css,
    tetris-app/src/components/NextPiece.css,
    tetris-app/src/components/Controls.css,
    tetris-app/src/components/MusicSelector.css
  </files>
  <action>
    1. Create ThemeToggle.jsx component:
       - Props: { theme, onToggle }
       - Simple button showing current mode with icon/text
       - Display "DMG" when gameboy, "MODERN" when modern
       - Style similar to settings-button

    2. Create ThemeToggle.css:
       - Use CSS variables for colors
       - Gameboy mode: add subtle pixel/retro font effect if desired

    3. Update Game.jsx:
       - Import and use useTheme hook
       - Import ThemeToggle component
       - Place ThemeToggle in right-panel, after MusicSelector before Settings button
       - Pass theme and toggleTheme to ThemeToggle

    4. Update Game.css to use CSS variables:
       - Replace hardcoded colors with var(--color-*)
       - Title gradient: use --color-accent
       - Overlay backgrounds: use --color-overlay-bg
       - Button styles: use --color-button-*
       - Add gameboy-specific rule: [data-theme="gameboy"] disables Starfield (hide it)
       - Add gameboy-specific rule: [data-theme="gameboy"] removes glow effects (text-shadow: none)

    5. Update GameBoard.css:
       - Replace rgba colors with CSS variables
       - Add [data-theme="gameboy"] .game-board rule with CSS filter:
         filter: sepia(100%) hue-rotate(50deg) saturate(200%) brightness(0.9)
         This converts all tetromino colors to Gameboy green shades

    6. Update ScorePanel.css:
       - Replace #88f with var(--color-accent)
       - Replace #fff with var(--color-text)
       - Replace #0f0 with var(--color-level)
       - Panel background: var(--color-panel-bg)
       - Panel border: var(--color-panel-border)

    7. Update HoldPiece.css:
       - Similar variable replacements
       - #f80 -> var(--color-accent-secondary)

    8. Update NextPiece.css (read first, similar pattern)

    9. Update Controls.css (read first, similar pattern)

    10. Update MusicSelector.css (read first, similar pattern)

    Important: Do NOT over-engineer. Keep changes minimal - just replace hardcoded colors with CSS variables. The filter on game-board handles tetromino colors.
  </action>
  <verify>
    - npm run build succeeds
    - Toggle button visible in right panel
    - Clicking toggle switches between modern (blue space theme) and gameboy (green DMG theme)
    - Theme persists after page refresh
    - Tetrominos appear green-tinted in gameboy mode
  </verify>
  <done>Theme toggle works, all UI colors switch between modern and Gameboy palettes, tetrominos show Gameboy green filter</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] Modern theme: Blue/purple space aesthetic (default)
- [ ] Gameboy theme: Green DMG 4-shade aesthetic
- [ ] Toggle button switches themes instantly
- [ ] Theme persists in localStorage across refresh
- [ ] Tetrominos appear green-tinted in Gameboy mode
- [ ] No visual glitches in either mode
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- THEME-01 satisfied: User can play with green-tinted DMG visuals
- THEME-02 satisfied: User can toggle between modern and Gameboy modes
</success_criteria>

<output>
After completion, create `.planning/phases/03-gameboy-theme/03-01-SUMMARY.md`
</output>

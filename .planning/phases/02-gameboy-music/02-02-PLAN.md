---
phase: 02-gameboy-music
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - tetris-app/src/components/MusicSelector.jsx
  - tetris-app/src/components/MusicSelector.css
  - tetris-app/src/components/Game.jsx
  - tetris-app/src/components/Game.css
autonomous: false

must_haves:
  truths:
    - "User can see current music track selection"
    - "User can switch between Type A, B, C, or Off"
    - "Music starts when game starts"
    - "Music pauses when game pauses"
    - "Music stops when game ends"
    - "Track selection persists across browser sessions"
  artifacts:
    - path: "tetris-app/src/components/MusicSelector.jsx"
      provides: "Music track selection UI"
      exports: ["MusicSelector"]
    - path: "tetris-app/src/components/MusicSelector.css"
      provides: "Styling for music selector"
  key_links:
    - from: "MusicSelector.jsx"
      to: "useMusic"
      via: "props from parent"
      pattern: "setTrack|currentTrack"
    - from: "Game.jsx"
      to: "useMusic.js"
      via: "hook consumption"
      pattern: "import.*useMusic"
    - from: "Game.jsx"
      to: "MusicSelector.jsx"
      via: "component render"
      pattern: "MusicSelector"
---

<objective>
Create music selection UI and integrate music playback with game lifecycle.

Purpose: Give users control over soundtrack selection and ensure music syncs with game state (start/pause/stop).
Output: MusicSelector component with track buttons, Game.jsx integration with useMusic hook.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-gameboy-music/02-01-SUMMARY.md

@tetris-app/src/components/Game.jsx
@tetris-app/src/hooks/useMusic.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MusicSelector component</name>
  <files>tetris-app/src/components/MusicSelector.jsx, tetris-app/src/components/MusicSelector.css</files>
  <action>
Create MusicSelector component for track selection.

Props:
- currentTrack: 'A' | 'B' | 'C' | null
- onTrackChange: (track) => void
- disabled?: boolean (disable during gameplay if needed)

Component structure:
- Label: "Music"
- 4 buttons in a row: "A", "B", "C", "Off"
- Active track gets highlighted style (like active key binding)
- Compact design to fit in right panel near Controls

CSS:
- .music-selector container
- .music-track-btn for each button
- .music-track-btn.active for current selection
- Use existing game color palette (blues, glows)
- Keep compact - this goes in the control panel area

Follow existing component patterns (Controls.jsx for reference).
  </action>
  <verify>Component renders without errors, buttons visible</verify>
  <done>MusicSelector displays 4 track options with visual selection state</done>
</task>

<task type="auto">
  <name>Task 2: Integrate useMusic into Game.jsx</name>
  <files>tetris-app/src/components/Game.jsx</files>
  <action>
Wire useMusic hook into Game component.

1. Import and use useMusic hook
2. Extract: currentTrack, setTrack, play, pause, stop, isPlaying (from music)
3. Call music.play() when game starts (in startGame callback)
4. Call music.pause() when game pauses (in togglePause or useEffect watching isPaused)
5. Call music.stop() when game ends (gameOver becomes true)
6. Call music.stop() if user stops playing mid-game

Add MusicSelector to right-panel:
- Import MusicSelector component
- Render below Controls, above settings button
- Pass currentTrack and onTrackChange={setTrack}
- Optionally disable during active gameplay (user should set before starting)

useEffect for game state sync:
- When isPaused changes: pause/resume music
- When gameOver changes to true: stop music
- When isPlaying changes to true and not paused: play music

Be careful with effect dependencies to avoid unnecessary restarts.
  </action>
  <verify>npm run build succeeds, no lint errors</verify>
  <done>Music starts/pauses/stops in sync with game state, selector visible in UI</done>
</task>

<task type="auto">
  <name>Task 3: Add MusicSelector styling</name>
  <files>tetris-app/src/components/Game.css</files>
  <action>
Add any additional layout styles needed for MusicSelector placement.

Ensure:
- MusicSelector fits cleanly in right-panel
- Spacing between Controls and MusicSelector is consistent
- Matches overall game aesthetic

May need minor adjustments to right-panel layout if MusicSelector adds height.
  </action>
  <verify>Visual inspection shows proper layout</verify>
  <done>MusicSelector properly positioned in game layout</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete music system with track selection UI and game integration</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000
    3. Before starting game:
       - See Music selector with A/B/C/Off buttons
       - Click each button, verify selection highlights
    4. Start game:
       - Verify music starts playing
       - Listen for recognizable melody (Type A = Korobeiniki theme)
    5. Press P to pause:
       - Verify music pauses
    6. Resume:
       - Verify music resumes
    7. Let game end (or trigger game over):
       - Verify music stops
    8. Change track to B, start new game:
       - Verify different melody plays
    9. Select "Off", start game:
       - Verify no music plays
    10. Refresh page:
       - Verify track selection is remembered
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues with music playback or UI</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` shows no new errors
- [ ] MusicSelector component renders in right panel
- [ ] All three tracks produce distinct melodies
- [ ] Music syncs with game lifecycle (start/pause/stop)
- [ ] Track selection persists across page refresh
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- User approved music playback quality and UI
- Phase 2 requirements (AUDIO-01 through AUDIO-04) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-gameboy-music/02-02-SUMMARY.md`
</output>
